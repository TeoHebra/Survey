<!-- blocks/block3‐ranking.html -->
<section class="survey-block active" id="block3" data-type="ranking">
  <h2>Block 3 &ndash; Vignette Ranking</h2>
  <p class="prompt">
    Please assign a unique rank to each vignette (1 = most necessary, 2 = second most, etc.). 
    Type a number (1–4) in the box next to each statement. Do not repeat ranks.
  </p>

  <!-- INLINE SCRIPT: checkDups() (unchanged) -->
  <script>
    function checkDups() {
      const inputs = document.querySelectorAll('#block3 .rank-input');
      const counts = {};
      inputs.forEach(input => {
        const val = input.value.trim();
        if (!val || !/^[1-4]$/.test(val)) return;
        counts[val] = (counts[val] || 0) + 1;
      });
      inputs.forEach(input => {
        const val = input.value.trim();
        if (val && counts[val] > 1) {
          input.classList.add('duplicate');
        } else {
          input.classList.remove('duplicate');
        }
      });
    }
  </script>

  <!-- ─────────── FOUR VIGNETTE ITEMS ─────────── -->
  <div class="ranking-item">
    <div class="number-wrapper">
      <input
        type="number"
        name="rank_v1"
        id="rank_v1"
        class="rank-input"
        min="1" max="4"
        required
        placeholder="1–4"
        oninput="checkDups()"
      />
      <div class="arrow up"></div>
      <div class="arrow down"></div>
    </div>
    <label for="rank_v1">
      <strong>Vignette 1:</strong> Lorem ipsum dolor sit amet…
    </label>
  </div>

  <div class="ranking-item">
    <div class="number-wrapper">
      <input
        type="number"
        name="rank_v2"
        id="rank_v2"
        class="rank-input"
        min="1" max="4"
        required
        placeholder="1–4"
        oninput="checkDups()"
      />
      <div class="arrow up"></div>
      <div class="arrow down"></div>
    </div>
    <label for="rank_v2">
      <strong>Vignette 2:</strong> Sed do eiusmod tempor incididunt…
    </label>
  </div>

  <div class="ranking-item">
    <div class="number-wrapper">
      <input
        type="number"
        name="rank_v3"
        id="rank_v3"
        class="rank-input"
        min="1" max="4"
        required
        placeholder="1–4"
        oninput="checkDups()"
      />
      <div class="arrow up"></div>
      <div class="arrow down"></div>
    </div>
    <label for="rank_v3">
      <strong>Vignette 3:</strong> Ut enim ad minim veniam…
    </label>
  </div>

  <div class="ranking-item">
    <div class="number-wrapper">
      <input
        type="number"
        name="rank_v4"
        id="rank_v4"
        class="rank-input"
        min="1" max="4"
        required
        placeholder="1–4"
        oninput="checkDups()"
      />
      <div class="arrow up"></div>
      <div class="arrow down"></div>
    </div>
    <label for="rank_v4">
      <strong>Vignette 4:</strong> Duis aute irure dolor in reprehenderit…
    </label>
  </div>

  <!-- ─────────── 3) JS TO HANDLE ARROW CLICKS ─────────── -->
  <script>
    document.querySelectorAll('#block3 .number-wrapper').forEach(wrapper => {
      const input = wrapper.querySelector('.rank-input');
      const up = wrapper.querySelector('.arrow.up');
      const down = wrapper.querySelector('.arrow.down');

      function clamp(val, min, max) {
        return Math.min(Math.max(val, min), max);
      }

      up.addEventListener('click', () => {
        const minVal = parseInt(input.getAttribute('min'), 10);
        const maxVal = parseInt(input.getAttribute('max'), 10);
        let current = parseInt(input.value, 10);
        if (isNaN(current)) current = minVal - 1;
        const nextVal = clamp(current + 1, minVal, maxVal);
        input.value = nextVal;
        input.dispatchEvent(new Event('input'));
      });

      down.addEventListener('click', () => {
        const minVal = parseInt(input.getAttribute('min'), 10);
        const maxVal = parseInt(input.getAttribute('max'), 10);
        let current = parseInt(input.value, 10);
        if (isNaN(current)) current = minVal + 1;
        const nextVal = clamp(current - 1, minVal, maxVal);
        input.value = nextVal;
        input.dispatchEvent(new Event('input'));
      });
    });
  </script>
</section>
