<!-- File: blocks/block3-ranking.html -->

<section class="survey-block active" id="block3" data-type="ranking">
  <h2>Block 3 – Vignette Ranking</h2>
  <p class="prompt">
    Please assign a unique rank to each vignette (1 = most necessary, 2 = second most, etc.). 
    Type a number (1–4) in the box next to each statement. Do not repeat ranks.
  </p>

  <script>
    // ─────────────── duplicate‐value checker ───────────────
    function checkDups() {
      const inputs = document.querySelectorAll('#block3 .rank-input');
      const counts = {};

      inputs.forEach(input => {
        const val = input.value.trim();
        // only consider numbers 1–4
        if (!val || !/^[1-4]$/.test(val)) return;
        counts[val] = (counts[val] || 0) + 1;
      });

      inputs.forEach(input => {
        const val = input.value.trim();
        if (val && counts[val] > 1) {
          input.classList.add('duplicate');
        } else {
          input.classList.remove('duplicate');
        }
      });
    }

    // ─────────────── bind arrow clicks immediately ───────────────
    (function() {
      // As soon as this <script> runs, Block 3’s DOM has already been inserted,
      // so we can safely query and attach listeners right away.
      const wrappers = document.querySelectorAll("#block3 .number-wrapper");
      wrappers.forEach(wrapper => {
        const input = wrapper.querySelector("input");
        const up = wrapper.querySelector(".arrow.up");
        const down = wrapper.querySelector(".arrow.down");

        if (up) {
          up.addEventListener("click", () => {
            let value = parseInt(input.value || "0");
            if (value < 4) {
              input.value = value + 1;
              checkDups();
            }
          });
        }

        if (down) {
          down.addEventListener("click", () => {
            let value = parseInt(input.value || "0");
            if (value > 1) {
              input.value = value - 1;
              checkDups();
            }
          });
        }
      });
    })();
  </script>

  <!-- ─────────── FOUR VIGNETTES TO RANK ─────────── -->
  <div class="ranking-item">
    <div class="number-wrapper">
      <input
        type="number"
        name="rank_v1"
        id="rank_v1"
        class="rank-input"
        min="1"
        max="4"
        required
        oninput="checkDups()"
      />
      <div class="arrow up"></div>
      <div class="arrow down"></div>
    </div>
    <label for="rank_v1"><strong>Vignette 1:</strong> Lorem ipsum dolor sit amet, consectetur adipiscing elit…</label>
  </div>

  <div class="ranking-item">
    <div class="number-wrapper">
      <input
        type="number"
        name="rank_v2"
        id="rank_v2"
        class="rank-input"
        min="1"
        max="4"
        required
        oninput="checkDups()"
      />
      <div class="arrow up"></div>
      <div class="arrow down"></div>
    </div>
    <label for="rank_v2"><strong>Vignette 2:</strong> Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua…</label>
  </div>

  <div class="ranking-item">
    <div class="number-wrapper">
      <input
        type="number"
        name="rank_v3"
        id="rank_v3"
        class="rank-input"
        min="1"
        max="4"
        required
        oninput="checkDups()"
      />
      <div class="arrow up"></div>
      <div class="arrow down"></div>
    </div>
    <label for="rank_v3"><strong>Vignette 3:</strong> Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris…</label>
  </div>

  <div class="ranking-item">
    <div class="number-wrapper">
      <input
        type="number"
        name="rank_v4"
        id="rank_v4"
        class="rank-input"
        min="1"
        max="4"
        required
        oninput="checkDups()"
      />
      <div class="arrow up"></div>
      <div class="arrow down"></div>
    </div>
    <label for="rank_v4"><strong>Vignette 4:</strong> Duis aute irure dolor in reprehenderit in voluptate velit esse cillum…</label>
  </div>

  <!-- ─────────── NAVIGATION BUTTONS ─────────── -->
  <div class="navigation">
    <button class="prev-btn">Back</button>
    <button class="next-btn">Next</button>
  </div>
</section>
